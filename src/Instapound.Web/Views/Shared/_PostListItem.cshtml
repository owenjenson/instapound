@model Instapound.Web.Models.PostViewModel

<article class="grid grid-rows-[auto_auto_auto] grid-cols-[auto_1fr] gap-x-4">
    <a class="grid grid-cols-subgrid col-span-2 items-center group max-w-fit" asp-controller="Profile" asp-action="Index" asp-route-id="@Model.Author.Id.ToString()">
        @{
            var avatar = Model.Author.Avatar is null ?
                "/images/avatars/default_avatar.png" :
                $"/images/avatars/{Model.Author.Avatar}";
        }
        
        <img
            class="cover aspect-square w-9 h-9 rounded-full p-0.5 border-2 border-primary"
            src="@avatar"
            loading="lazy" />

        <div class="w-fit">
            <div class="flex gap-2 items-center w-fit">
                <h3 class="font-semibold text-lg mb-0 group-hover:underline">@Model.Author.Name</h3>
                <small class="text-on-surface-muted">@@@Model.Author.UserName</small>
            </div>

            <span class="block text-sm text-on-surface-muted">
                @if (Model.ReleasedAt.Date == DateTime.Today)
                {
                    <text>@Model.ReleasedAt.ToShortTimeString()</text>
                }
                else
                {
                    <text>@Model.ReleasedAt.ToShortDateString()</text>
                }
            </span>
        </div>
    </a>

    <a asp-controller="Posts" asp-action="Index" asp-route-id="@Model.Id" class="block col-start-2 mt-2 mb-3 hover:opacity-80 w-fit">
        <p>
            @Model.Text
        </p>

        @if (Model.Image is not null)
        {
            <img
                class="mt-2 border border-outline rounded-lg max-h-[36rem] object-contain bg-surface-container"
                src="~/images/posts/@Model.Image"
                loading="lazy" />
        }
    </a>

    <div class="col-start-2 flex gap-2 items-center">
        @await Html.PartialAsync("_LikeButton", new LikeButtonViewModel(Model.LikesCount, Model.Id, "/Posts/Like", Model.CurrentUserLikes))
        <a asp-controller="Posts" asp-action="Index" asp-route-id="@Model.Id" class="btn flex gap-2 text-sm">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-3.5 w-3.5 lucide lucide-message-square"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" /></svg>
            <span>@Model.CommentsCount comments</span>
        </a>

        @if (Model.CurrentUserIsAuthor)
        {
            <a class="btn btn-icon" asp-controller="Posts" asp-action="Edit" asp-route-id="@Model.Id">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-3.5 w-3.5 lucide lucide-pencil"><path d="M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z" /><path d="m15 5 4 4" /></svg>
            </a>

            <form asp-controller="Posts" asp-action="Remove" asp-route-id="@Model.Id" method="post">
                <button class="btn btn-icon text-danger"
                        type="submit"
                        data-confirm="Are you sure you want to remove this post?">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-danger h-3.5 w-3.5 lucide lucide-trash-2"><path d="M3 6h18" /><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" /><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" /><line x1="10" x2="10" y1="11" y2="17" /><line x1="14" x2="14" y1="11" y2="17" /></svg>
                </button>
            </form>
        }

        @if (Model.IsEdited)
        {
            <div class="text-xs text-on-surface-muted ml-1 flex gap-1.5 items-center">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-3 w-3 lucide lucide-pencil"><path d="M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z" /><path d="m15 5 4 4" /></svg>
                <span>Edited</span>
            </div>
        }
    </div>
</article>